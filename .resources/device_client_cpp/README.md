# üì° IoT Device Controller (ESP8266)

–ú–æ–¥—É–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –Ω–∞ C++ –¥–ª—è ESP8266 —Å WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –ø–∏–Ω–∞–º–∏, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –≤—Ä–µ–º–µ–Ω–∏.

---

## üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 1. **DeviceController.ino**

–ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª. –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –≤—Å–µ—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤:

* –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Wi-Fi, –≤—Ä–µ–º–µ–Ω–∏, –ø–∏–Ω–æ–≤, WebSocket;
* —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ª–æ–≥–∏–∫–∞.

### 2. **WiFiManager.h**

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Wi-Fi:

* –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∑–∞–¥–∞–Ω–Ω–æ–π —Å–µ—Ç–∏;
* –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–∏–≥–Ω–∞–ª–∞.

### 3. **TimeManager.h**

–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏:

* NTPClient —Å —Ç–∞–π–º–∑–æ–Ω–æ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é GMT+5);
* —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ `TimeLib.h`.

### 4. **PinController.h**

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –ø–∏–Ω–æ–≤:

* —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `PinConfig` (—Ä–µ–∂–∏–º, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, –∏–º—è);
* –º–µ—Ç–æ–¥—ã `set_mode`, `set_schedule`, `set_state`, `set_name`;
* –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏;
* –≥–µ–Ω–µ—Ä–∞—Ü–∏—è JSON-–æ—Ç—á—ë—Ç–æ–≤ –æ —Ç–µ–∫—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏.

### 5. **WebSocketManager.h**

–†–∞–±–æ—Ç–∞ —Å WebSocket:

* –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É —Å `auth_token`;
* –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏ –ø—Ä–∏—ë–º —Å–æ–æ–±—â–µ–Ω–∏–π;
* –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á—ë—Ç–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥–µ;
* –æ–±—Ä–∞–±–æ—Ç–∫–∞ `ping/pong` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.

---

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `ESP8266WiFi.h`
* `ArduinoWebsockets.h`
* `WiFiUdp.h`
* `NTPClient.h`
* `TimeLib.h`
* `ArduinoJson.h`

---

## üöÄ –°—Ç–∞—Ä—Ç –ø—Ä–æ–µ–∫—Ç–∞

1. –ó–∞–¥–∞–π—Ç–µ —Å–≤–æ–∏ Wi-Fi –¥–∞–Ω–Ω—ã–µ –∏ WebSocket URL –≤ `DeviceController.ino`:

   ```cpp
   const char* SSID = "Galaxy";
   const char* PASSWORD = "60533185";
   const char* WS_URL = "wss://your-server.com/ws";
   const String AUTH_TOKEN = "{\"auth_token\":\"your_token\"}";
   ```

2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –Ω–∞ ESP8266.

3. –ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ WebSocket-—Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–º–∞–Ω–¥—ã:

   ```json
   {
     "action": "set_state", "pin": 4, "state": 1
   }
   {
     "action": "set_mode", "pin": 4, "mode": "auto"
   }
   {
     "action": "set_schedule", "pin": 4, "schedule": {
         "on_time": "12:00",
         "off_time": "13:00"
     }
   }
   {
     "action": "report"
   }
   ```

4. –í –æ—Ç–≤–µ—Ç ESP –æ—Ç–ø—Ä–∞–≤–∏—Ç JSON-–æ—Ç—á—ë—Ç —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø–∏–Ω–æ–≤.

---

## üß† –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

* OTA –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—à–∏–≤–∫–∏
* –•—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ `EEPROM`
* –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫/—Å–µ–Ω—Å–æ—Ä–æ–≤
* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å WebApp
* –ó–∞—â–∏—â—ë–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (TLS)

---

–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –≤ —Ä–∞–º–∫–∞—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —á–∏—Å—Ç–æ—Ç—ã –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç–∏ –ª–æ–≥–∏–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è IoT-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏.
